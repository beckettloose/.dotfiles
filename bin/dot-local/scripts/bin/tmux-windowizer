#!/usr/bin/env bash
#
# Usage: tmux-windowizer <window_name> <command>
#
# Create a named window in the current tmux session, then execute a command in
# it. If a window with the specified name already exists, a new one will not be
# created. This is very useful for creating automated session setup scripts.
#
# Originally written by ThePrimeagen but modified to fix quotation problems.

branch_name=$(basename "$1")
session_name=$(tmux display-message -p "#S")
clean_name=$(echo "$branch_name" | tr "./" "__")
target="$session_name:$clean_name"

if ! tmux has-session -t "$target" 2> /dev/null; then
    tmux neww -dn "$clean_name"
fi

shift
tmux send-keys -t "$target" "$*"
